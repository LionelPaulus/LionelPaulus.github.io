<!DOCTYPE html>
<html lang="en">

<head>
    <title>Star Wars : Space Racers</title>
    <meta name="viewport" content="width=device-width,user-scalable=no" />
</head>

<body>
    <div id="content">
        <ul>
            <li>acceleration x:
                <span id="accelerationX"></span>g</li>
            <li>acceleration y:
                <span id="accelerationY"></span>g</li>
            <li>acceleration z:
                <span id="accelerationZ"></span>g</li>
            <br><button id="calibrate">Calibrate</button>
        </ul>
    </div>

    <script src="http://192.168.1.15:3000/socket.io/socket.io.js"></script>
    <script src="scripts/NoSleep.min.js"></script>
    <script type="text/javascript">
        if (window.DeviceMotionEvent !== undefined) { // If device has accelerometer support
            // Enable noSleep
            var noSleep = new NoSleep();
            noSleep.enable();
            // Chrome solution
            document.keepScreenAwake = true;

            // Node server connect
            var socket = io.connect('192.168.1.15:3000');
            var datas = {};
            socket.emit('gyroscope');

            var calibrate = document.querySelector("#calibrate");

            window.ondevicemotion = function(e) {
                var x = event.accelerationIncludingGravity.x,
                    y = event.accelerationIncludingGravity.y,
                    z = event.accelerationIncludingGravity.z;

                if((navigator.userAgent.match(/iPhone/i)) || (navigator.userAgent.match(/iPod/i))) {
                    z = -z;
                }
                socket.emit('position', JSON.stringify({
                    x: x,
                    y: y,
                    z: z
                }));

                // For tests only
                document.getElementById("accelerationX").innerHTML = Math.floor(x);
                document.getElementById("accelerationY").innerHTML = Math.floor(y);
                document.getElementById("accelerationZ").innerHTML = Math.floor(z);
            };
        }
    </script>

</body>

</html>
